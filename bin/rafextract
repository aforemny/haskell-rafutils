#! /run/current-system/sw/bin/zsh

cabal configure || exit 1
cabal build     || exit 1

mkdir -p tmp
cd tmp

find ../lol_game_client -name "*.raf" | while read fn; do
  ../dist/build/raflist/raflist "$fn" | while read target; do
    ../dist/build/rafextract/rafextract "$fn" "$target"
    if [ $? -ne 0 ]; then
      echo "$fn"
      echo "$target"
      exit 1
    fi
    rm -f $(basename "$target")
  done
done

cd ..
rm -r tmp

exit 0
